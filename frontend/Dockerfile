# syntax=docker/dockerfile:1.7
FROM node:20-slim AS build
WORKDIR /app

# Accept build arguments
#  Policy ID and Token Names passed as build arguments
ARG VITE_POLICY_ID
ARG VITE_PLASTIC_TOKEN_NAME
ARG VITE_USDM_TOKEN_NAME
# Plastik required to vote
ARG VITE_MINIMUM_PLASTIK_TO_VOTE
ARG VITE_MINIMUM_PLASTIK
# Wallet info
ARG VITE_ADMIN_WALLET_ADDRESS
ARG VITE_DEAD_WALLET_ADDRESS
ARG VITE_PC_WALLET
ARG VITE_SERVER_URL
# Blockfrost
ARG VITE_BLOCKFROST_URL
ARG VITE_BLOCKFROST_PROJECT_ID
ARG VITE_BLOCKFROST_MAINNET_URL
ARG VITE_BLOCKFROST_MAINNET_PROJECT_ID
# cbor files
ARG VITE_STAKE_REWARD_CBOR
ARG VITE_REFI_CBOR
ARG VITE_GOVERNANCE_CBOR
# Cardano scan
ARG VITE_CARDANO_SCAN_URL
ARG VITE_CARDANO_SCAN_MAINNET_URL


# Convert to ENV for Vite build
#  Policy ID and Token Names passed as build arguments
ENV VITE_POLICY_ID=${VITE_POLICY_ID}
ENV VITE_PLASTIC_TOKEN_NAME=${VITE_PLASTIC_TOKEN_NAME}
ENV VITE_USDM_TOKEN_NAME=${VITE_USDM_TOKEN_NAME}
# Plastik required to vote
ENV VITE_MINIMUM_PLASTIK_TO_VOTE=${VITE_MINIMUM_PLASTIK_TO_VOTE}
ENV VITE_MINIMUM_PLASTIK=${VITE_MINIMUM_PLASTIK}
# Wallet info
ENV VITE_ADMIN_WALLET_ADDRESS=${VITE_ADMIN_WALLET_ADDRESS}
ENV VITE_DEAD_WALLET_ADDRESS=${VITE_DEAD_WALLET_ADDRESS}
ENV VITE_PC_WALLET=${VITE_PC_WALLET}
ENV VITE_SERVER_URL=/api
# Blockfrost
ENV VITE_BLOCKFROST_URL=${VITE_BLOCKFROST_URL}
ENV VITE_BLOCKFROST_PROJECT_ID=${VITE_BLOCKFROST_PROJECT_ID}
ENV VITE_BLOCKFROST_MAINNET_URL=${VITE_BLOCKFROST_MAINNET_URL}
ENV VITE_BLOCKFROST_MAINNET_PROJECT_ID=${VITE_BLOCKFROST_MAINNET_PROJECT_ID}
# cbor files
ENV VITE_STAKE_REWARD_CBOR=${VITE_STAKE_REWARD_CBOR}
ENV VITE_REFI_CBOR=${VITE_REFI_CBOR}
ENV VITE_GOVERNANCE_CBOR=${VITE_GOVERNANCE_CBOR}
# Cardano scan
ENV VITE_CARDANO_SCAN_URL=${VITE_CARDANO_SCAN_URL}
ENV VITE_CARDANO_SCAN_MAINNET_URL=${VITE_CARDANO_SCAN_MAINNET_URL}


COPY package.json package-lock.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:1.27-alpine AS runtime
COPY nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
